<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-translate-customization" content="108d9124921d80c3-80e20d618ff053c8-g4f02ec6f3dba68b7-c">
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Python&amp;CPython核心 | Adam Yan Na Blog</title>
<meta name="generator" content="Jekyll v4.3.2">
<meta property="og:title" content="Python&amp;CPython核心">
<meta name="author" content="Teddy">
<meta property="og:locale" content="en_US">
<meta name="description" content="Python&amp;CPython核心 “生成器与协程、CPython虚拟机原理、CPython解释器原理、内存管理与引用计数与优化、高级第三方库、Python语法魔术”">
<meta property="og:description" content="Python&amp;CPython核心 “生成器与协程、CPython虚拟机原理、CPython解释器原理、内存管理与引用计数与优化、高级第三方库、Python语法魔术”">
<link rel="canonical" href="http://localhost:4000/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84-%E8%AF%AD%E8%A8%80/python/2020/04/26/python-core.html">
<meta property="og:url" content="http://localhost:4000/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84-%E8%AF%AD%E8%A8%80/python/2020/04/26/python-core.html">
<meta property="og:site_name" content="Adam Yan Na Blog">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-04-26T00:00:00+08:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Python&amp;CPython核心">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Teddy"},"dateModified":"2020-04-26T00:00:00+08:00","datePublished":"2020-04-26T00:00:00+08:00","description":"Python&amp;CPython核心 “生成器与协程、CPython虚拟机原理、CPython解释器原理、内存管理与引用计数与优化、高级第三方库、Python语法魔术”","headline":"Python&amp;CPython核心","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84-%E8%AF%AD%E8%A8%80/python/2020/04/26/python-core.html"},"url":"http://localhost:4000/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84-%E8%AF%AD%E8%A8%80/python/2020/04/26/python-core.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="icon" href="">
  <link rel="canonical" href="http://localhost:4000">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-noto-sans@0.0.72/index.min.css">
  <link rel="stylesheet" href="/assets/css/main.css">
  <script src="/assets/js/main.js"></script><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Adam Yan Na Blog">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script>
<!-- and it's easy to individually load additional languages -->
<script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/go.min.js" async></script>



















<script>
// Init highlight js
document.addEventListener('DOMContentLoaded', function(event) {
  var els = document.querySelectorAll('pre code')

  function addLangData(block) {
    var outer = block.parentElement.parentElement.parentElement;
    var lang = block.getAttribute('data-lang');
    for (var i = 0; i < outer.classList.length; i++) {
      var cls = outer.classList[i];
      if (cls.startsWith('language-')) {
        lang = cls;
        break;
      }
    }
    if (!lang) {
      cls = block.getAttribute('class');
      lang = cls ? cls.replace('hljs ', '') : '';
    }
    if (lang.startsWith('language-')) {
      lang = lang.substr(9);
    }
    block.setAttribute('class', 'hljs ' + lang);
    block.parentNode.setAttribute('data-lang', lang);
  }

  function addBadge(block) {
    var enabled = ('true' || 'true').toLowerCase();
    if (enabled == 'true') {
      var pre = block.parentElement;
      pre.classList.add('badge');
    }
  }

  function handle(block) {
    addLangData(block);
    addBadge(block)
    hljs.highlightBlock(block);
  }

  for (var i = 0; i < els.length; i++) {
    var el = els[i];
    handle(el);
  }
});
</script>

<style>
  /* code language badge */
  pre.badge::before {
    content: attr(data-lang);
    color: #fff;
    background-color: #ff4e00;
    padding: 0 .5em;
    border-radius: 0 2px;
    text-transform: uppercase;
    text-align: center;
    min-width: 32px;
    display: inline-block;
    position: absolute;
    right: 0;
  }

  /* fix wrong badge display for firefox browser */
  code > table pre::before {
    display: none;
  }
</style>
<script src="//cdnjs.cloudflare.com/ajax/libs/photoswipe/5.3.7/umd/photoswipe-lightbox.umd.min.js" async></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/photoswipe/5.3.7/umd/photoswipe.umd.min.js" async></script>
<link href="//cdnjs.cloudflare.com/ajax/libs/photoswipe/5.3.7/photoswipe.min.css" rel="stylesheet">
<style>
  .pswp .pswp__container .pswp__img {
    background-color: white;
  }
</style>

<script>
  function initPhotoSwipe() {
    let customOptions = {};

    try {
      const data = ``.replaceAll("=>", ":");
      customOptions = JSON.parse(data);
    } catch (e) {
      console.info("Invalid custom photo previewer options! " + e.message);
    }

    // Define object and gallery options
    const options = Object.assign(
      {
        gallery: "section.main",
        children: "a.photo-swipe",
        photo_scale: 2,
        // dynamic import is not supported in UMD version
        pswpModule: PhotoSwipe,
      },
      customOptions
    );

    const galleryEl = document.querySelector(options.gallery);
    if (!galleryEl) {
      return;
    }

    const imgEls = [];
    const els = galleryEl.querySelectorAll("img:not(.emoji)");
    els.forEach((el) => {
      if (el.src.trim() == "") {
        return;
      }
      if (!imgEls.includes(el)) {
        imgEls.push(el);
      }
    });

    if (imgEls.length === 0) {
      return;
    }

    imgEls.forEach((imgEl) => {
      imgEl.outerHTML = `
      <a class="photo-swipe"
        href="${imgEl.src}"
        data-pswp-width="${
          Math.max(imgEl.naturalWidth, imgEl.width) * options.photo_scale
        }"
        data-pswp-height="${
          Math.max(imgEl.naturalHeight, imgEl.height) * options.photo_scale
        }"
        data-pswp-caption="${imgEl.getAttribute("caption") || imgEl.alt}"
        target="_blank">
        ${imgEl.outerHTML}
      </a>`;
    });

    // Initialize PhotoSwipe 5
    var lightbox = new PhotoSwipeLightbox(options);

    lightbox.init();
  }

  window.addEventListener("load", initPhotoSwipe);
</script>
</head>
<body>



























































































































<header class="site-header " role="banner">

  <div class="wrapper">
    <div class="site-header-inner">
<span class="site-brand"><a class="site-brand-inner" rel="author" href="/">
  <img class="site-favicon" title="Adam Yan Na Blog" src="" onerror="this.style.display='none'">
  Adam Yan Na Blog
</a>
</span><nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger">
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewbox="0 0 18 15" width="18px" height="15px">
                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
              </svg>
            </span>
          </label>

          <div class="trigger">
<a class="page-link" href="/about.html">ABOUT</a><a class="page-link" href="/archives.html">ARCHIVES</a><a class="page-link" href="/categories.html">CATEGORIES</a><a class="page-link" href="/">HOME</a><a class="page-link" href="/tags.html">TAGS</a>









<span class="page-link">



<div id="google_translate_element" style="display: none;">
</div>

<span class="ct-language">
  <ul class="list-unstyled ct-language-dropdown">
    
      <li>
        <a href="#" class="lang-select" data-lang="en">
          
          <img src="https://cdn.countryflags.com/thumbs/united-states-of-america/flag-400.png" title="English">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="fr">
          
          <img src="https://cdn.countryflags.com/thumbs/france/flag-400.png" title="French">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="zh-CN">
          
          <img src="https://cdn.countryflags.com/thumbs/china/flag-400.png" title="Chinese(Simple)">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="ja">
          
          <img src="https://cdn.countryflags.com/thumbs/japan/flag-400.png" title="Japanese">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="ko">
          
          <img src="https://cdn.countryflags.com/thumbs/south-korea/flag-400.png" title="Korean">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="ru">
          
          <img src="https://cdn.countryflags.com/thumbs/russia/flag-400.png" title="Russian">
          
        </a>
      </li>
    
  </ul>
</span>

<script type="text/javascript">
function googleTranslateElementInit() {
  new google.translate.TranslateElement({
    pageLanguage: 'en',
    autoDisplay: false,
    layout: google.translate.TranslateElement.InlineLayout.VERTICAL
  }, 'google_translate_element');

  // Links to cross-origin destinations are unsafe
  var gll = document.getElementsByClassName('goog-logo-link')[0];
  if (gll) {
    gll.setAttribute('rel', 'noopener');
  }

  function restoreLang() {
    var iframe = document.getElementsByClassName('goog-te-banner-frame')[0];
    if (!iframe) return;

    var innerDoc = iframe.contentDocument || iframe.contentWindow.document;
    var restore_el = innerDoc.getElementsByTagName("button");

    for (var i = 0; i < restore_el.length; i++) {
      if (restore_el[i].id.indexOf("restore") >= 0) {
        restore_el[i].click();
        var close_el = innerDoc.getElementsByClassName("goog-close-link");
        close_el[0].click();
        return;
      }
    }
  }

  function triggerHtmlEvent(element, eventName) {
    var event;
    if (document.createEvent) {
      event = document.createEvent('HTMLEvents');
      event.initEvent(eventName, true, true);
      element.dispatchEvent(event);
    } else {
      event = document.createEventObject();
      event.eventType = eventName;
      element.fireEvent('on' + event.eventType, event);
    }
  }

  var googleCombo = document.querySelector("select.goog-te-combo");
  var langSelect = document.querySelector('.ct-language');
  langSelect.addEventListener('click', function(event) {
    if (!event.target) {
      return;
    }

    var selected = document.querySelector('.ct-language .ct-language-selected');
    if (selected) {
      selected.classList.remove('ct-language-selected');
    }

    var target = event.target;
    while (target && target !== langSelect ) {
      if (target.matches('.lang-select')) {
        break;
      }
      target = target.parentElement;
    }

    if (target && target.matches('.lang-select')) {
      var lang = target.getAttribute('data-lang');
      if (googleCombo.value == lang) {
        restoreLang();
      } else {
        target.parentElement.classList.add('ct-language-selected');
        googleCombo.value = lang;
        triggerHtmlEvent(googleCombo, 'change');
      }
    }

    event.preventDefault();
  });
}
</script>

<script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit" async></script>
</span>
</div>
        </nav>
</div>
  </div>
</header>

<script>
  function initHeader() {
    var lastScrollY = getScrollPos().y;
    var documentElement = document.documentElement;

    function storeScrollData() {
      var y = getScrollPos().y;var scrollStatus = "";

      if (y <= 0) {
        scrollStatus = "top";
      } else if ((window.innerHeight + y) >= document.body.offsetHeight) {
        scrollStatus = "bottom";
      } else {
        var isScrollDown = (y - lastScrollY > 0) ? true : false;
        scrollStatus = isScrollDown ? "down" : "up";
      }

      lastScrollY = y;
      documentElement.setAttribute("data-scroll-status", scrollStatus);
    }

    window.addEventListener('scroll', function(e) {
      storeScrollData();
    });

    storeScrollData();
  }
  document.addEventListener('DOMContentLoaded', initHeader);
</script>
















































































































































<script>
  function hashLocate(hashValue) {
    hashValue = hashValue.replace(/^.*#h-/, '');
    hashValue = decodeURIComponent(hashValue);
    var element = document.getElementById(hashValue);

    if (!element) {
      return;
    }

    var header = document.querySelector('header.site-header');
    var headerRect = header.getBoundingClientRect();
    var headerTop = Math.floor(headerRect.top);
    var headerHeight = Math.floor(headerRect.height);
    var scrollPos = getScrollPos();
    var offsetY = element.offsetTop - (headerTop + headerHeight + 20);

    if (offsetY == scrollPos.y) {
      return;
    }

    if (headerTop == 0  && offsetY > scrollPos.y) {
      offsetY += headerHeight + 2;
    } else if (headerTop < 0  && offsetY < scrollPos.y) {
      offsetY -= headerHeight - 2;
    }

    smoothScrollTo(offsetY);
  }

  // The first event occurred
  window.addEventListener('load', function(event) {
    if (window.location.hash) {
      hashLocate(window.location.hash);
    }
  });

  // The first event occurred
  window.addEventListener('click', function(event) {
    if (event.target.tagName.toLowerCase() == 'a') {
      hashLocate(event.target.getAttribute('href'));
    }
  });
</script>
<div class="theme-toggle">
  <input type="checkbox" id="theme-switch">
  <label for="theme-switch">
    <div class="toggle"></div>
    <div class="names">
      <p class="light">Light</p>
      <p class="dark">Dark</p>
    </div>
  </label>
</div>




<script>
  (function() {
    var sw = document.getElementById('theme-switch');
    var html = document.getElementsByTagName('html')[0];
    var nightModeOption = ('auto' || 'auto').toLowerCase();
    var storage = nightModeOption === 'manual'
        ? localStorage
        : sessionStorage;
    var themeData = loadThemeData();

    function saveThemeData(data) {
      storage.setItem('theme', JSON.stringify(data));
    }

    function loadThemeData() {
      var data = storage.getItem('theme');
      try {
        data = JSON.parse(data ? data : '');
      } catch(e) {
        data = { nightShift: undefined, autoToggleAt: 0 };
        saveThemeData(data);
      }
      return data;
    }

    function handleThemeToggle(nightShift) {
      themeData.nightShift = nightShift;
      saveThemeData(themeData);
      html.dataset.theme = nightShift ? 'dark' : 'light';
      setTimeout(function() {
        sw.checked = nightShift ? true : false;
      }, 50);
    }

    function autoThemeToggle() {
      // Next time point of theme toggle
      var now = new Date();
      var toggleAt = new Date();
      var hours = now.getHours();
      var nightShift = hours >= 19 || hours <=7;

      if (nightShift) {
        if (hours > 7) {
          toggleAt.setDate(toggleAt.getDate() + 1);
        }
        toggleAt.setHours(7);
      } else {
        toggleAt.setHours(19);
      }

      toggleAt.setMinutes(0);
      toggleAt.setSeconds(0);
      toggleAt.setMilliseconds(0)

      var delay = toggleAt.getTime() - now.getTime();

      // auto toggle theme mode
      setTimeout(function() {
        handleThemeToggle(!nightShift);
      }, delay);

      return {
        nightShift: nightShift,
        toggleAt: toggleAt.getTime()
      };
    }

    // Listen the theme toggle event
    sw.addEventListener('change', function(event) {
      handleThemeToggle(event.target.checked);
    });

    if (nightModeOption == 'auto') {
      var data = autoThemeToggle();

      // Toggle theme by local setting
      if (data.toggleAt > themeData.autoToggleAt) {
        themeData.autoToggleAt = data.toggleAt;
        handleThemeToggle(data.nightShift);
      } else {
        handleThemeToggle(themeData.nightShift);
      }
    } else if (nightModeOption == 'manual') {
      handleThemeToggle(themeData.nightShift);
    } else {
      var nightShift = themeData.nightShift;
      if (nightShift === undefined) {
        nightShift = nightModeOption === 'on';
      }
      handleThemeToggle(nightShift);
    }
  })();
</script>
<div id="click-to-top" class="click-to-top">
  <i class="fa fa-arrow-up"></i>
</div>
<script>
  (function () {
    const clickToTop = document.getElementById('click-to-top');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 100) {
        clickToTop.classList.add('show')
      }else {
        clickToTop.classList.remove('show')
      }
    });
    clickToTop.addEventListener('click', () => {
      window.smoothScrollTo(0);
    });
  })();
</script>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="framework">
  <section class="main">

     <div class="post">
  <section>









<header class="post-header">
  <h1 class="post-title p-name" itemprop="name headline">Python&amp;CPython核心</h1>
  <h2 class="post-subtitle"></h2>

  <div class="post-meta">
    <time class="dt-published" datetime="2020-04-26T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Apr 26, 2020
    </time><span class="post-author left-vsplit"><i class="fa fa-pencil"></i> Teddy</span>
    
































    <span class="post-reading-time left-vsplit"><i class="fa fa-clock-o"></i> About 8 mins</span>
  </div>
<div class="post-tags">
<a class="post-tag" href="/tags.html#CPython">#CPython</a><a class="post-tag" href="/tags.html#Python">#Python</a>
</div></header>
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="post-content e-content" itemprop="articleBody">

      <h1 id="pythoncpython核心">Python&amp;CPython核心</h1>
<blockquote>
  <p>“生成器与协程、CPython虚拟机原理、CPython解释器原理、内存管理与引用计数与优化、高级第三方库、Python语法魔术”</p>
</blockquote>

<h1 id="cpython核心">CPython核心</h1>

<h2 id="i-虚拟机工作原理cpython源代码工作方式">I. 虚拟机工作原理&amp;CPython源代码&amp;工作方式</h2>
<h1 id="evaluation-loop-cevalc">Evaluation Loop <strong>ceval.c</strong>
</h1>
<ul>
  <li>Python虚拟机的 <strong>核心部分</strong>，迭代执行python字节码指令；迭代执行的实现依靠 <strong>for</strong> 循环；</li>
  <li>Python/ceval.c 模块，包含实现执行部分的核心代码，核心函数为 <strong>PyEval_EvalFrameEx</strong>，该函数中包含执行循环；</li>
  <li>ceval.c 模块会针对不同的平台或者操作系统类型，进行对线程和虚拟机有不同的优化；</li>
</ul>

<h1 id="执行循环的工作原理">执行循环的工作原理</h1>
<ul>
  <li>执行前的准备工作 initialization &amp; prepare context
    <ul>
      <li>
<strong>_PyEval_EvalCodeWithName</strong>
        <ul>
          <li>代码对象从代码块创建，在python源代码中，代码块包含函数、模块、类、装饰器等等；</li>
          <li>从代码块创建的代码对象会经过一连串的函数调用 run_mod -&gt; PyEval_EvalCode -&gt; PyEval_EvalCodeEx -&gt; _PyEval_EvalCodeWithName -&gt; PyEval_EvalFrameEx</li>
          <li>_PyEval_EvalCodeWithName 的过程包括
            <ul>
              <li>初始化“帧对象”，用来提供执行“代码对象”的上下文</li>
              <li>为“frame fast locals” 添加 <em>dict</em> 关键词</li>
              <li>为 “fastlocals” 添加位置参数 <em>positional arguments</em> （python函数中的*args类型的参数）</li>
              <li>将 无位置变量序列 <em>non-positional variable sequence</em> 和 无关键词参数 <em>non-keyword arguments</em> 添加到 <strong>fastlocals数组</strong>，这些变量都被存放在 <strong>元组</strong> 类型的数据结构中；（python函数中的*args，**kwargs类型的参数）</li>
              <li>检查代码块是否有提供或是否重复提供 kwargs 类型的参数；</li>
              <li>检查是否缺少*args位置参数，如果发现缺少则抛出错误</li>
              <li>添加默认参数到 <em>fastlocals</em> 数组</li>
              <li>初始化存储空间和单元变量（storage and cell variables）并拷贝空闲变量数组到当前帧中；</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>循环的执行 Evaluation Loop
    <ul>
      <li>
        <p>始化过程完成后，PyEval_EvalFrameEx会以参数的形式调用帧（frame object）；</p>
      </li>
      <li>
        <p>PyEval_EvalFrameEx 会进行C的优化，例如宏和计算gotos；</p>
      </li>
      <li>Evaluation Loop中的核心重要变量 （ceval.c）
        <ul>
          <li>**stack_pointer，引用下一个要执行的“执行帧”的空闲槽（free slot）；</li>
          <li>*next_instr，引用执行循环需要执行的下一个指令；可以将该变量视为C程序内存中栈帧的程序计数器指针<code class="language-plaintext highlighter-rouge">%rip</code>
</li>
          <li>opcode，引用当前正在执行的opcode或者将要执行的opcode</li>
          <li>oparg，引用当前执行或将要执行的opcode所需参数</li>
          <li>why，执行循环 Evaluation Loop 是一个无线循环 - for(;;)，执行循环需要跳出或终止条件，该变量引用当前要跳出循环的原因；例如跳出循环的原因是因为代码快函数的返回，该变量则应用“WHY_RETURN”状态；</li>
          <li>fastlocals，引用保存了本地变量的数组</li>
          <li>freevars，引用，变量名称列表，但是这些名称在代码块中并没有被定义；</li>
          <li>retval，引用代码快的返回值；</li>
          <li>co，引用了代码对象，参考虚拟机原理，该对象保存着执行循环的“字节码指令”和过程变量；</li>
          <li>names，引用了“执行帧对象”的代码块中所有值的名称；</li>
          <li>consts，引用了代码对象中使用的常量；
            <blockquote>
              <p>回顾虚拟机字节码 python vm bytecode instruction
字节码长度为 16bit，Python虚拟机使用小端法（最低最前，大多数机器都是用小端法表示地址，16进制的最低有效位存储从虚拟内存低地址位开始存储）
字节码包含两个字节，第一个字节存放OPARG，第二个字节存放OPCODE；</p>
            </blockquote>
          </li>
        </ul>

        <table>
          <thead>
            <tr>
              <th>8bit</th>
              <th>8bit</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>OPARG</td>
              <td>OPCODE</td>
            </tr>
          </tbody>
        </table>
      </li>
      <li>重要的C宏
        <ul>
          <li>TARGET(op) 定义<code class="language-plaintext highlighter-rouge">#define TARGET(op)</code> ，扩展为case op，将当前要执行的字节码和代码快的实现进行匹配；</li>
          <li>DISPATCH，扩展为 continue，和宏 - FAST_DISPATCH，用来处理执行循环执行完该opcode之后的“控制流”；</li>
          <li>FAST_DISPATH，扩展为跳入fast_next_opcode标签；</li>
        </ul>
      </li>
      <li>处理字节码相关的C宏
        <ul>
          <li>INSTR_OFFSET()，这个宏在当前的指令数组中为指令提供“字偏移”</li>
          <li>NEXTOPARG()，这个宏用来更新下一个要执行的指令和过程变量的opcode和oparg变量；</li>
        </ul>
      </li>
      <li>执行循环过程分析</li>
    </ul>
  </li>
</ul>

<h2 id="ii-内存管理和底层数据结构的实现及数据结构的内存分配回收扩容-heap">II. 内存管理和底层数据结构的实现及数据结构的内存分配、回收、扩容 “heap”</h2>
<h3 id="优化">优化</h3>
<ul>
  <li>最小开销的python代码中变量创建和管理</li>
  <li>Py_INCREF和Py_DECREF了，它们都是内存管理函数。CPython使用引用计数来管理对象的生命周期。一旦新建引用指向对象，那么Py_INCREF会将对象的引用递增，一旦引用超出作用域，Py_INCREF就会递减对象的引用。</li>
  <li>
    <p>垃圾回收分析</p>

    <ul>
      <li>
        <p>python的垃圾回收发生的条件</p>

        <blockquote>
          <p>https://docs.python.org/2/library/gc.html
官方文档：The GC classifies objects into three generations depending on how many collection sweeps they have survived. New objects are placed in the youngest generation (generation 0). If an object survives a collection it is moved into the next older generation. Since generation 2 is the oldest generation, objects in that generation remain there after a collection. In order to decide when to run, the collector keeps track of the number object allocations and deallocations since the last collection. When the number of allocations minus the number of deallocations exceeds threshold0, collection starts. Initially only generation 0 is examined. If generation 0 has been examined more than threshold1 times since generation 1 has been examined, then generation 1 is examined as well. Similarly, threshold2 controls the number of collections of generation 1 before collecting generation 2.</p>
        </blockquote>
      </li>
      <li>
        <p>python内存管理的三层结构</p>

        <ul>
          <li>
            <p>generation 0：新建的对象</p>
          </li>
          <li>
            <p>generation 1：垃圾回收后，任然存在引用，则归入1</p>
          </li>
          <li>
            <p>generation 2：最老的无法被collection函数回收的对象</p>
          </li>
        </ul>
      </li>
      <li>
        <p>回收机制会在内存分配数量和取消分配数量的差值超过 一个特定的阈值 才会触发</p>
      </li>
      <li>
        <p>通过gc模块，可以查看默认的阈值，且可以通过调用set_threshold函数，配置定制的阈值</p>
        <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="kn">import</span> <span class="nn">gc</span>
 <span class="n">gc</span><span class="p">.</span><span class="n">get_threshold</span><span class="p">()</span>  <span class="c1">#gc模块中查看阈值的方法
</span> <span class="p">(</span><span class="mi">700</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>这里的解释是：阈值超过700时才会对g0的对象进行回收，每10次回收g0会发生1次回收g1，每10次回收g1会发生1次回收g2；</li>
  <li>gc模块提供主动触发垃圾回收的函数
    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="k">def</span> <span class="nf">collect</span><span class="p">(</span><span class="n">generation</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
 <span class="n">collect</span><span class="p">([</span><span class="n">generation</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">n</span>
</code></pre></div>    </div>
    <blockquote>
      <p>With no arguments, run a full collection.  The optional argument
 may be an integer specifying which generation to collect.  A ValueError
 is raised if the generation number is invalid.</p>
    </blockquote>
    <ul>
      <li>
        <p>对于不传入参数的调用来说，会发起g0 g1 g2三代的全部的回收；</p>
      </li>
      <li>CPython对C运行库提供的free函数的调用，也存在一定的条件</li>
      <li>第3层：最上层，用户对Python对象的直接操作</li>
    </ul>
  </li>
  <li>第1层和第2层：内存池，有Python的接口函数PyMem_Malloc实现-----若请求分配的内存在1~256字节之间就使用内存池管理系统进行分配，调用malloc函数分配内存，但是每次只会分配一块大小为256K的大块内存，不会调用free函数释放内存，将该内存块留在内存池中以便下次使用。
    <ul>
      <li>第0层：大内存-----若请求分配的内存大于256K，malloc函数分配内存，free函数释放内存；</li>
    </ul>
  </li>
</ul>

<h2 id="iii-生成器和协程-generator--coroutine">III. 生成器和协程 generator &amp; coroutine</h2>
<h3 id="生成器对象-generator">生成器对象 generator</h3>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* _PyGenObject_HEAD defines the initial segment of generator
   and coroutine objects. */</span>
<span class="cp">#define _PyGenObject_HEAD(prefix)                                           \
    PyObject_HEAD                                                           \、
</span>    <span class="cm">/* Note: gi_frame can be NULL if the generator is "finished" */</span>         \
    <span class="k">struct</span> <span class="n">_frame</span> <span class="o">*</span><span class="n">prefix</span><span class="err">##</span><span class="n">_frame</span><span class="p">;</span>                                          \
    <span class="cm">/* True if generator is being executed. */</span>                              \
    <span class="kt">char</span> <span class="n">prefix</span><span class="err">##</span><span class="n">_running</span><span class="p">;</span>                                                  \
    <span class="cm">/* The code object backing the generator */</span>                             \
    <span class="n">PyObject</span> <span class="o">*</span><span class="n">prefix</span><span class="err">##</span><span class="n">_code</span><span class="p">;</span>                                                \
    <span class="cm">/* List of weak reference. */</span>                                           \
    <span class="n">PyObject</span> <span class="o">*</span><span class="n">prefix</span><span class="err">##</span><span class="n">_weakreflist</span><span class="p">;</span>                                         \
    <span class="cm">/* Name of the generator. */</span>                                            \
    <span class="n">PyObject</span> <span class="o">*</span><span class="n">prefix</span><span class="err">##</span><span class="n">_name</span><span class="p">;</span>                                                \
    <span class="cm">/* Qualified name of the generator. */</span>                                  \
    <span class="n">PyObject</span> <span class="o">*</span><span class="n">prefix</span><span class="err">##</span><span class="n">_qualname</span><span class="p">;</span>                                            \
    <span class="n">_PyErr_StackItem</span> <span class="n">prefix</span><span class="err">##</span><span class="n">_exc_state</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="cm">/* The gi_ prefix is intended to remind of generator-iterator. */</span>
    <span class="n">_PyGenObject_HEAD</span><span class="p">(</span><span class="n">gi</span><span class="p">)</span>
<span class="p">}</span> <span class="n">PyGenObject</span><span class="p">;</span>
</code></pre></div></div>

<ul>
  <li>结构底层定义为 _PyGenObject_HEAD, 结构体对象为PyGenObject
    <ul>
      <li>在生成器对象中包含了 帧对象的引用 和 代码对象的引用，回顾python虚拟机实现可知，代码对象在运行时会生成帧对象，解释器对帧对象进行执行，其中包含了代码对象中的Python虚拟机指令和过程变量；</li>
      <li>运行的生成器提供了 “suspended”阻塞 和 “resumed”就绪 的状态切换的功能；</li>
      <li>定义的属性包括和宏
        <ul>
          <li>*prefix##_frame
            <ul>
              <li>帧对象，包含生成器对象的代码对象引用，用来执行该对象</li>
            </ul>
          </li>
          <li>prefix##_running
            <ul>
              <li>布尔值，用来确定当前的生成器是否还在运行</li>
            </ul>
          </li>
          <li>*prefix##_code
            <ul>
              <li>代码对象引用，生成器用来执行的对象</li>
            </ul>
          </li>
          <li>*prefix##_name
            <ul>
              <li>生成器名称</li>
            </ul>
          </li>
          <li>*prefix##_qualname
            <ul>
              <li>“qualified” 的名称，多数情况下和_name相同；</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>生成器和协程运行原理
    <ul>
      <li>生成器通过对内置next python函数的调用来执行，当遇到yield python内置表达式时，生成器会发生阻塞；</li>
      <li>生成器如何保存和获取执行状态，又是怎样在遇到特定的状态是对当前的执行进行状态的更新的
        <ul>
          <li>如何保存执行状态
            <ul>
              <li>生成器对象中保存着当前帧对象的引用，该引用中包含了所有生成器需要执行的上下文（代码对象），通过对帧对象的引用，生成器可以捕获执行过程中的所有状态；（状态可以指过程的python虚拟机指令及变量）</li>
            </ul>
          </li>
          <li>yield 表达式
            <ul>
              <li>生成器的执行过程中，在遇到yield语句时会发生主动放弃或让出当前执行时间片，然后Python虚拟机会对当前的生成器的状态进行保存，时间片发生轮转；</li>
            </ul>
          </li>
          <li>生成器如何完成调度（这里的调度就是生成器的阻塞和就绪的状态切换，且生成器需要主动放弃当前执行的权限，或者说执行的时间片）
            <ul>
              <li>next内置函数，当生成器调用next内置函数，next函数的主要作用是对已经发生阻塞的生成器恢复执行，该函数会完成两个作用
                <ol>
                  <li>对当前的指针 “tp_iternext” 解除引用，”tp_iternext” 可以理解为python虚拟机的程序计数器指针，每个运行的线程或者生成器对象在执行期间都会引用程序计数器，从而告诉虚拟机下一条要执行的指令；</li>
                  <li>随机调用 “tp_iternext” 程序计数器关联的任何其他函数，对于当前线程的其他生成器来说，会调用 gen_iternext -&gt; gen_send_ex，最终通过该函数的调用会重新执行之前被阻塞的生成器；</li>
                </ol>
              </li>
              <li>通过以上两种方式生成器/协程实现了在Python虚拟机内部的时间片轮转；</li>
            </ul>
          </li>
          <li>Python的生成器同样支持参数传递；</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="调度">调度</h3>

<h2 id="iv-线程状态对象cil结构对象解释器对象">IV. 线程状态对象&amp;CIL结构对象&amp;解释器对象</h2>
<h3 id="调度-1">调度</h3>

<h2 id="v-对象对象管理">V. 对象&amp;对象管理</h2>

<h2 id="vi-内置方法的高级用法">VI. 内置方法的高级用法</h2>
<h3 id="数据模型">数据模型</h3>
<ul>
  <li><a href="https://docs.python.org/3/reference/datamodel.html">datamodel</a></li>
  <li>元类 <code class="language-plaintext highlighter-rouge">__metaclass__</code>
    <ul>
      <li><a href="https://docs.python.org/3/reference/datamodel.html">datamodel</a></li>
      <li>python中默认情况下，类型由type()函数构成，类的主体会创建一个新的namespace用于执行，类名会和type(name, bases, namespace)进行绑定；</li>
      <li>python可以在类声明行中传递 <code class="language-plaintext highlighter-rouge">metaclass keyword argument</code> 实现元类，或者通过对传递了该参数的类进行继承，原来需要继承自type；</li>
      <li>元类就是其父类继承自type的类型（子孙类都可以实现元类）；</li>
      <li>类定义中指定的任何其他关键字参数都将传递到下面描述的所有元类操作；</li>
      <li>当类定义被执行后，发生了以下的步骤：
        <ul>
          <li>MRO 入口处理</li>
          <li>确定该类型适当的元类</li>
          <li>准备类型的命名空间</li>
          <li>执行类型主体</li>
          <li>类型对象呗创建并返回</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Singleton</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="n">__instance</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">def</span> <span class="nf">__int__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Singleton</span><span class="p">,</span> <span class="bp">self</span><span class="p">).</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cls</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cls</span><span class="p">.</span><span class="n">__instance</span><span class="p">:</span>
            <span class="n">cls</span><span class="p">.</span><span class="n">__instance</span><span class="p">[</span><span class="n">cls</span><span class="p">]</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Singleton</span><span class="p">,</span> <span class="n">cls</span><span class="p">).</span><span class="n">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">.</span><span class="n">__instance</span><span class="p">[</span><span class="n">cls</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">Publisher</span><span class="p">():</span>

    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">Singleton</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">Meta</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">MySubclass</span><span class="p">(</span><span class="n">MyClass</span><span class="p">):</span>
    <span class="k">pass</span>
</code></pre></div></div>

<ul>
  <li>抽象基类 <code class="language-plaintext highlighter-rouge">ABC</code>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">__class__</code>
    <ul>
      <li>该方法可以访问当前实例的类，通过该函数可以修改一个实例对象对某个类的引用；</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">__new__</code>
    <ul>
      <li>静态方法，在python的语法中，一切皆对象，<code class="language-plaintext highlighter-rouge">__new__</code> 方法用来创建新的类的实例，该方法的调用中，cls也就是类对象要作为第一个参数，其他参数用来传递给<code class="language-plaintext highlighter-rouge">__new__</code>来构造新的对象，新的对象可能是类的实例，也可能是一个新的类型；</li>
      <li>在 <code class="language-plaintext highlighter-rouge">__new__</code> 实现中，如果需要实现对父类的调用，可以使用 <code class="language-plaintext highlighter-rouge">super().__new__(cls[, ...])</code> 并且需要传入父类所需要的基本参数，获得父类实例后再进行任何其他修改；</li>
      <li>在 <code class="language-plaintext highlighter-rouge">__new__</code> 实现中，如果需要实现对父类的类对象调用，可以使用 <code class="language-plaintext highlighter-rouge">super(xxx, cls).__new__(cls[, ...])</code> ，可以获得新的类型，对于在对象构造期间调用 <code class="language-plaintext highlighter-rouge">__new __（）</code> 并返回cls的实例或子类，则将像 <code class="language-plaintext highlighter-rouge">__init __（self [，...]）</code> 一样调用新实例的 <code class="language-plaintext highlighter-rouge">__init __（）</code> 方法，其中self是新实例，而 其余参数与传递给对象构造函数的参数相同。</li>
      <li>如果<code class="language-plaintext highlighter-rouge">__new__()</code>, 方法调用没有返回任何实例或者子类，那么新实例的<code class="language-plaintext highlighter-rouge">__init __（）</code>方法就不会被调用；</li>
      <li>
<code class="language-plaintext highlighter-rouge">__new__</code> 核心作用
        <ul>
          <li>主要是允许 <strong>不可变</strong> 类型的子类，自定义的创建实例；</li>
          <li>也用来实现自定义的类和其属性的实现；</li>
          <li>通常也被自定义元类覆盖。</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">new_cls</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">DataModel</span><span class="p">,</span> <span class="n">cls</span><span class="p">).</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DataModel</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">new_cls</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_cls</span>
</code></pre></div></div>
<ul>
  <li>
<code class="language-plaintext highlighter-rouge">__init__</code>
    <ul>
      <li>在实例创建完成后调用（通过<code class="language-plaintext highlighter-rouge">__new __（）</code>），但在实例返回给调用方之前被调用。 参数是传递给类构造函数表达式的参数。 如果基类具有<code class="language-plaintext highlighter-rouge">__init __（）</code>方法，则派生类的<code class="language-plaintext highlighter-rouge">__init __（）</code>方法（如果有）必须显式调用它，以确保实例的基类部分的正确初始化。 例如：<code class="language-plaintext highlighter-rouge">super（）.__ init __（[args ...]）。</code>
</li>
      <li>子类中如果想要调用父类的<code class="language-plaintext highlighter-rouge">__init __（）</code>方法，必须在<code class="language-plaintext highlighter-rouge">__init __（）</code>中通过<code class="language-plaintext highlighter-rouge">super（）</code>显示的调用；</li>
      <li>因为<code class="language-plaintext highlighter-rouge">__new __（）</code>和<code class="language-plaintext highlighter-rouge">__init __（）</code>在构造对象时一起工作（<code class="language-plaintext highlighter-rouge">__new __（）</code>来创建它，而<code class="language-plaintext highlighter-rouge">__init __（）</code>来对其进行自定义），所以<code class="language-plaintext highlighter-rouge">__init __（）</code>不能返回任何非<code class="language-plaintext highlighter-rouge">None</code>值； 这样做将导致在运行时引发<code class="language-plaintext highlighter-rouge">TypeError</code>。</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">__call__</code>
    <ul>
      <li>该方法会在一个对象被当做函数调用的情况下，调用，<code class="language-plaintext highlighter-rouge">object.__call__(self[, args...]), object()</code>
</li>
      <li>通过在类中定义__call __（）方法，可以使任意类的实例成为可调用的。</li>
      <li>python的任何对象都可以使用<code class="language-plaintext highlighter-rouge">callable()</code>来判断是否可调用，对于不可调用的对象，只需要在对象中实现<code class="language-plaintext highlighter-rouge">__call__</code>方法，例如在元类中实现call方法，则继承元类的子类在生成实例时就会调用；</li>
    </ul>
  </li>
  <li>总结
    <ul>
      <li>单例的多种实现方式在类中重写<code class="language-plaintext highlighter-rouge">__new __（）</code>，类继承元类，并在元类中使用<code class="language-plaintext highlighter-rouge">__call__()</code> 方法实现，装饰器实现；</li>
      <li>There is no fucking magic, all the implementation are from CPython pyobjectclass;</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Singleton</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="n">__instance</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">"metaclass __call__"</span>
        <span class="k">if</span> <span class="n">cls</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cls</span><span class="p">.</span><span class="n">__instance</span><span class="p">:</span>
            <span class="n">cls</span><span class="p">.</span><span class="n">__instance</span><span class="p">[</span><span class="n">cls</span><span class="p">]</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Singleton</span><span class="p">,</span> <span class="n">cls</span><span class="p">).</span><span class="n">__call__</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">.</span><span class="n">__instance</span><span class="p">[</span><span class="n">cls</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">BasicSub</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">Singleton</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">"__init__"</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BasicSub</span><span class="p">,</span> <span class="bp">self</span><span class="p">).</span><span class="n">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">"__new__"</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">BasicSub</span><span class="p">).</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">"__call__"</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">BasicSub</span><span class="p">()</span>
<span class="n">a</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="vii-高级第三方库的实现">VII. 高级第三方库的实现</h2>
<h3 id="web框架">Web框架</h3>
<h3 id="并发框架">并发框架</h3>
<ul>
  <li>futures</li>
  <li>Gevent
    <ul>
      <li>基于C的高性能事件循环模型库libev，实现的基于API和网络相关任务的并发模型；</li>
    </ul>
  </li>
  <li>greenlet</li>
</ul>

<h3 id="c实现的第三方库">C实现的第三方库</h3>

<p>https://github.com/python/cpython/blob/master/Python/ceval.c</p>

<p>https://www.cnblogs.com/qdhxhz/p/9757390.html</p>

<p>https://redis.io/commands</p>

<p>openstack https://blog.csdn.net/dylloveyou/article/details/80698420</p>

<p>socket fd https://www.cnblogs.com/DengGao/p/file_symbol.html</p>

<p>mmap https://www.cnblogs.com/huxiao-tee/p/4660352.html</p>

<h2 id="viii">VIII.</h2>

<h1 id="python-runtime-services">Python Runtime Services</h1>
<p><a href="https://docs.python.org/3/library/python.html">Runtime Services</a></p>



    </div>

</article>
<div class="post-nav">
<a class="previous" href="/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84-%E8%AF%AD%E8%A8%80/golang/2020/04/26/golang-core.html" title="Golang核心">Golang核心</a><a class="next" href="/%E5%AE%9E%E8%B7%B5/%E9%9C%80%E6%B1%82%E5%AE%9E%E7%8E%B0/2020/05/13/data-patrol.html" title="时序数据完整性的方法巡检工具">时序数据完整性的方法巡检工具</a>
</div>
<div class="post-related">
      <div>Related Articles</div>
      <ul>
        <li class="">
          <a class="post-link" href="/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84-%E7%90%86%E8%AE%BA/%E8%AE%BA%E6%96%87%E6%9C%9F%E5%88%8A/2020/03/02/Turing-machine.html" title="图灵机-可计算理论">
            图灵机-可计算理论<span class="post-badges">
  <span class="post-badge badge-top">TOP</span>
  <span class="post-badge badge-new">NEW</span>
</span>
</a>
        </li>
<li class="">
          <a class="post-link" href="/%E5%AE%9E%E8%B7%B5/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/2020/07/12/git-advanced.html" title="Git进阶">
            Git进阶<span class="post-badges">
  <span class="post-badge badge-top">TOP</span>
  <span class="post-badge badge-new">NEW</span>
</span>
</a>
        </li>
<li class="">
          <a class="post-link" href="/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84-%E5%BA%94%E7%94%A8/%E8%87%AA%E5%8A%A8%E5%8C%96/2020/05/14/ansible-automation.html" title="Ansible自动化">
            Ansible自动化<span class="post-badges">
  <span class="post-badge badge-top">TOP</span>
  <span class="post-badge badge-new">NEW</span>
</span>
</a>
        </li>
<li class="">
          <a class="post-link" href="/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84-%E8%AF%AD%E8%A8%80/golang/2020/04/26/golang-core.html" title="Golang核心">
            Golang核心<span class="post-badges">
  <span class="post-badge badge-top">TOP</span>
  <span class="post-badge badge-new">NEW</span>
</span>
</a>
        </li>
</ul>
    </div>
<div class="post-comments"></div></section>
</div>


  </section>
  <section class="sidebar" style="margin-left: 15px;">
    <!-- Get sidebar items --><style type="text/css" media="screen">
.post-menu ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
</style>

<div class="post-menu">
  <div class="post-menu-title">TOC</div>
  <div class="post-menu-content"></div>
</div>

<script>
  function generateContent() {
    var menu = document.querySelector(".post-menu");
    var menuContent =  menu.querySelector(".post-menu-content");
    var headings = document.querySelector(".post-content").querySelectorAll("h2, h3, h4, h5, h6");

    // Hide menu when no headings
    if (headings.length === 0) {
      return menu.style.display = "none";
    }

    // Generate post menu
    var menuHTML = '';
    for (var i = 0; i < headings.length; i++) {
      var h = headings[i];
      menuHTML += (
        '<li class="h-' + h.tagName.toLowerCase() + '">'
        + '<a href="#h-' + h.getAttribute('id') + '">' + h.textContent + '</a></li>');
    }

    menuContent.innerHTML = '<ul>' + menuHTML + '</ul>';

    // The header element
    var header = document.querySelector('header.site-header');

    function doMenuCollapse(index, over_items) {
      var items = menuContent.firstChild.children;

      if (over_items == undefined) {
        over_items = 20;
      }

      if (items.length < over_items) {
        return;
      }

      var activeItem = items[index];
      var beginItem = activeItem
      var endItem = activeItem
      var beginIndex = index;
      var endIndex = index + 1;
      while (beginIndex >= 0
        && !items[beginIndex].classList.contains('h-h2')) {
        beginIndex -= 1;
      }
      while (endIndex < items.length
        && !items[endIndex].classList.contains('h-h2')) {
        endIndex += 1;
      }
      for (var i = 0; i < beginIndex; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
      for (var i = beginIndex + 1; i < endIndex; i++) {
        item = items[i]
        // if (!item.classList.contains('h-h2')) {
          item.style.display = '';
        // }
      }
      for (var i = endIndex; i < items.length; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
    }

    // Init menu collapsed
    doMenuCollapse(-1);

    // Active the menu item
    window.addEventListener('scroll', function (event) {
      var lastActive = menuContent.querySelector('.active');
      var changed = true;
      var activeIndex = -1;
      for (var i = headings.length - 1; i >= 0; i--) {
        var h = headings[i];
        var headingRect = h.getBoundingClientRect();
        var headerRect = header.getBoundingClientRect();
        var headerTop = Math.floor(headerRect.top);
        var headerHeight = Math.floor(headerRect.height);
        var headerHeight = headerTop + headerHeight + 20;
        if (headingRect.top <= headerHeight) {
          var id = 'h-' + h.getAttribute('id');
          var a = menuContent.querySelector('a[href="#' + id  + '"]');
          var curActive = a.parentNode;
          if (curActive) {
            curActive.classList.add('active');
            activeIndex = i;
          }
          if (lastActive == curActive) {
            changed = false;
          }
          break;
        }
      }
      if (changed) {
        if (lastActive) {
          lastActive.classList.remove('active');
        }
        doMenuCollapse(activeIndex);
      }
      event.preventDefault();
    });
  }
  generateContent();
</script>
</section>
</div>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">
    <div class="site-footer-inner">
<div>Unpublished Work <span class="copyleft">©</span> 2017-2023 Adam Yan Na</div>
      <div>Powered by <a title="Jekyll is a simple, blog-aware, static site
      generator." href="https://jekyllrb.com/">Jekyll</a> &amp; <a title="Yat, yet
      another theme." href="https://github.com/jeffreytse/jekyll-theme-yat">Yat Theme</a>.</div>
      <div class="footer-col rss-subscribe">Subscribe <a href="/feed.xml">via RSS</a>
</div>
    </div>
  </div>
</footer>
</body>
</html>
